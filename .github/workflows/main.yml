on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
    types: [synchronize, labeled, unlabeled]
  repository_dispatch:
    types: [trigger_main_workflow]

jobs:
  deploy_stage1_job:
    runs-on: ubuntu-latest
    name: deploy on stage1
    steps:
      # To use this repository's private action,
      # you must check out the repository
      - name: Checkout
        uses: actions/checkout@v2
      - name: check deploy stage1
        uses: ./ # Uses an action in the root directory
        id: check-deploy-stage1
        with:
          action-github-token: ${{ secrets.GITHUB_TOKEN }}
          personal-github-token: ${{ secrets.PERSONAL_GITHUB_TOKEN }}
          env-label: 'stage1'
      - name: Deploy Notification
        if: ${{ steps.check-deploy-stage1.outputs.should-deploy == 'true' }}
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.STAGING_SLACK_WEBHOOK }}
          SLACK_USERNAME: beopBot
          SLACK_ICON_EMOJI: :bike:
          SLACK_TITLE: Deployed ${{ github.repository }} ${{ github.ref }} on staging
          SLACK_FOOTER: 
          MSG_MINIMAL: true

